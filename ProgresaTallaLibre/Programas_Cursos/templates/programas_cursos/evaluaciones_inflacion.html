{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz 1: Conceptos B√°sicos</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body class="page-quiz-inflacion">
    <div class="container">
        <!-- Pantalla de inicio -->
        <div id="startScreen" class="screen active start-screen">
            <div class="start-card">
                <h1>Quiz 1: Conceptos B√°sicos</h1>
                <p class="description">Definici√≥n de inflaci√≥n y conceptos fundamentales</p>
                
                <div class="info-box">
                    <div class="info-row">
                        <span class="info-label">‚è±Ô∏è 15 minutos</span>
                        <span class="info-label">üìù 10 preguntas</span>
                    </div>
                    <div class="info-detail">
                        <strong>Nota m√≠nima de aprobaci√≥n: 70%</strong><br>
                        Las preguntas tienen diferentes niveles de dificultad. Lee cuidadosamente cada una.
                    </div>
                </div>

                <button class="btn-start" onclick="startQuiz()">Iniciar Quiz</button>
            </div>
        </div>

        <!-- Pantalla del quiz -->
        <div id="quizScreen" class="screen">
            <div class="quiz-header">
                <div class="header-content">
                    <div class="timer" id="timer">
                        ‚è∞ <span id="timerDisplay">15:00</span>
                    </div>
                    <div class="question-counter" id="questionCounter">
                        Pregunta 1 de 10
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 10%"></div>
                </div>
            </div>

            <div class="question-card">
                <div id="difficultyBadge" class="difficulty-badge"></div>
                <h2 class="question-text" id="questionText"></h2>

                <div class="options" id="optionsContainer"></div>

                <div class="navigation">
                    <button class="btn btn-prev" id="btnPrev" onclick="previousQuestion()" style="display: none;">
                        Anterior
                    </button>
                    <button class="btn btn-next" id="btnNext" onclick="nextQuestion()" disabled>
                        Siguiente
                    </button>
                    <button class="btn btn-finish" id="btnFinish" onclick="finishQuiz()" style="display: none;" disabled>
                        ‚úì Finalizar Quiz
                    </button>
                </div>

                <div class="answers-info" id="answersInfo">
                    Preguntas respondidas: 0 de 10
                </div>
            </div>
        </div>

        <!-- Pantalla de resultados -->
        <div id="resultsScreen" class="screen results-screen">
            <div class="results-card">
                <div id="resultIcon" class="icon-result"></div>
                <h2 class="results-title" id="resultTitle"></h2>

                <div class="score-box">
                    <div class="score-number" id="scoreNumber"></div>
                    <div class="score-label" id="scoreLabel"></div>

                    <div class="score-details">
                        <div class="detail-item" id="correctAnswers"></div>
                        <div class="detail-item">Nota m√≠nima requerida: 70%</div>
                    </div>
                </div>

                <button class="btn-return" onclick="returnToMain()">
                    ‚Üê Volver al Men√∫ Principal
                </button>
            </div>
        </div>
    </div>

    <script>
        const quiz = {
            title: "Quiz 1: Conceptos B√°sicos",
            totalQuestions: 10,
            duration: 900,
            passingScore: 70,
            questions: [
                {
                    question: "¬øQu√© es la inflaci√≥n?",
                    options: [
                        "Aumento sostenido y generalizado del nivel de precios",
                        "Disminuci√≥n del poder adquisitivo",
                        "Aumento de la producci√≥n econ√≥mica",
                        "Reducci√≥n de la oferta monetaria"
                    ],
                    correct: 0,
                    difficulty: "F√°cil"
                },
                {
                    question: "El √çndice de Precios al Consumidor (IPC) mide:",
                    options: [
                        "La producci√≥n industrial total",
                        "Los cambios en el costo de una canasta fija de bienes y servicios",
                        "El nivel de empleo en la econom√≠a",
                        "Las exportaciones netas del pa√≠s"
                    ],
                    correct: 1,
                    difficulty: "F√°cil"
                },
                {
                    question: "La deflaci√≥n se caracteriza por:",
                    options: [
                        "Aumento generalizado de precios",
                        "Disminuci√≥n sostenida del nivel de precios",
                        "Estabilidad absoluta de precios",
                        "Aumento de la demanda agregada"
                    ],
                    correct: 1,
                    difficulty: "Media"
                },
                {
                    question: "¬øQu√© representa la 'inflaci√≥n subyacente' o 'core inflation'?",
                    options: [
                        "La inflaci√≥n total sin excepciones",
                        "Solo la inflaci√≥n de alimentos",
                        "La inflaci√≥n excluyendo alimentos y energ√≠a por su volatilidad",
                        "La inflaci√≥n promedio hist√≥rica"
                    ],
                    correct: 2,
                    difficulty: "Media"
                },
                {
                    question: "La estanflaci√≥n es un fen√≥meno econ√≥mico que combina:",
                    options: [
                        "Inflaci√≥n alta y crecimiento econ√≥mico robusto",
                        "Deflaci√≥n y desempleo bajo",
                        "Inflaci√≥n elevada con estancamiento econ√≥mico y alto desempleo",
                        "Estabilidad de precios con expansi√≥n econ√≥mica"
                    ],
                    correct: 2,
                    difficulty: "Media"
                },
                {
                    question: "Seg√∫n la teor√≠a cuantitativa del dinero (ecuaci√≥n de Fisher: MV = PQ), si la velocidad del dinero (V) y la producci√≥n (Q) se mantienen constantes, ¬øqu√© ocurre con el nivel de precios (P) si se duplica la oferta monetaria (M)?",
                    options: [
                        "Se reduce a la mitad",
                        "Permanece constante",
                        "Se duplica",
                        "Aumenta cuatro veces"
                    ],
                    correct: 2,
                    difficulty: "Dif√≠cil"
                },
                {
                    question: "El 'efecto Cantillon' en econom√≠a monetaria se refiere a:",
                    options: [
                        "El impacto uniforme del dinero en todos los sectores",
                        "La distribuci√≥n desigual de los efectos de cambios en la oferta monetaria seg√∫n qui√©n recibe el dinero primero",
                        "La neutralidad del dinero a corto plazo",
                        "El control directo de precios por el gobierno"
                    ],
                    correct: 1,
                    difficulty: "Dif√≠cil"
                },
                {
                    question: "¬øQu√© tipo de inflaci√≥n se produce cuando el aumento de precios se origina por un incremento en los costos de producci√≥n?",
                    options: [
                        "Inflaci√≥n de demanda",
                        "Inflaci√≥n importada",
                        "Inflaci√≥n de costos (cost-push)",
                        "Inflaci√≥n inercial"
                    ],
                    correct: 2,
                    difficulty: "Media"
                },
                {
                    question: "La hiperinflaci√≥n se define t√©cnicamente como una inflaci√≥n que supera:",
                    options: [
                        "10% anual",
                        "50% mensual",
                        "100% anual",
                        "20% trimestral"
                    ],
                    correct: 1,
                    difficulty: "Dif√≠cil"
                },
                {
                    question: "El concepto de 'ilusi√≥n monetaria' describe:",
                    options: [
                        "La falsificaci√≥n de billetes",
                        "El ahorro excesivo en efectivo",
                        "La tendencia de las personas a pensar en t√©rminos nominales sin ajustar por inflaci√≥n",
                        "El uso de m√∫ltiples monedas simult√°neamente"
                    ],
                    correct: 2,
                    difficulty: "Dif√≠cil"
                }
            ]
        };

        let currentQuestion = 0;
        let answers = {};
        let timeLeft = quiz.duration;
        let timerInterval = null;

        function startQuiz() {
            document.getElementById('startScreen').classList.remove('active');
            document.getElementById('quizScreen').classList.add('active');
            startTimer();
            loadQuestion();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    finishQuiz();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;

            const timerElement = document.getElementById('timer');
            if (timeLeft < 60) {
                timerElement.classList.add('warning');
            } else {
                timerElement.classList.remove('warning');
            }
        }

        function loadQuestion() {
            const q = quiz.questions[currentQuestion];
            
            document.getElementById('questionCounter').textContent = 
                `Pregunta ${currentQuestion + 1} de ${quiz.totalQuestions}`;
            
            const progress = ((currentQuestion + 1) / quiz.totalQuestions) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            
            const badge = document.getElementById('difficultyBadge');
            badge.textContent = q.difficulty;
            badge.className = 'difficulty-badge difficulty-' + 
                (q.difficulty === 'F√°cil' ? 'easy' : q.difficulty === 'Media' ? 'medium' : 'hard');
            
            document.getElementById('questionText').textContent = q.question;
            
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            q.options.forEach((option, index) => {
                const div = document.createElement('div');
                div.className = 'option';
                if (answers[currentQuestion] === index) {
                    div.classList.add('selected');
                }
                div.onclick = () => selectOption(index);
                
                const letter = String.fromCharCode(65 + index);
                div.innerHTML = `
                    <div class="option-letter">${letter}</div>
                    <div class="option-text">${option}</div>
                `;
                
                container.appendChild(div);
            });
            
            updateButtons();
            updateAnswersInfo();
        }

        function selectOption(index) {
            answers[currentQuestion] = index;
            loadQuestion();
        }

        function updateButtons() {
            const btnPrev = document.getElementById('btnPrev');
            const btnNext = document.getElementById('btnNext');
            const btnFinish = document.getElementById('btnFinish');
            
            btnPrev.style.display = currentQuestion > 0 ? 'block' : 'none';
            
            const isAnswered = answers[currentQuestion] !== undefined;
            
            if (currentQuestion < quiz.totalQuestions - 1) {
                btnNext.style.display = 'block';
                btnFinish.style.display = 'none';
                btnNext.disabled = !isAnswered;
            } else {
                btnNext.style.display = 'none';
                btnFinish.style.display = 'block';
                const allAnswered = Object.keys(answers).length === quiz.totalQuestions;
                btnFinish.disabled = !allAnswered;
            }
        }

        function updateAnswersInfo() {
            const answered = Object.keys(answers).length;
            document.getElementById('answersInfo').textContent = 
                `Preguntas respondidas: ${answered} de ${quiz.totalQuestions}`;
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }

        function nextQuestion() {
            if (currentQuestion < quiz.totalQuestions - 1 && answers[currentQuestion] !== undefined) {
                currentQuestion++;
                loadQuestion();
            }
        }

        function saveResultsLocally(score, correctAnswers) {
            const results = {
                quizTitle: quiz.title,
                score: score,
                correctAnswers: correctAnswers,
                totalQuestions: quiz.totalQuestions,
                date: new Date().toLocaleString(),
                answers: answers
            };

            localStorage.setItem("quiz1_results", JSON.stringify(results));
        }

        function finishQuiz() {
            clearInterval(timerInterval);

            let correctAnswers = 0;
            quiz.questions.forEach((q, index) => {
                if (answers[index] === q.correct) {
                    correctAnswers++;
                }
            });

            const score = Math.round((correctAnswers / quiz.totalQuestions) * 100);
            const passed = score >= quiz.passingScore;

            // Guardar resultados para la p√°gina principal
            localStorage.setItem('quiz1_score', score.toString());
            localStorage.setItem('quiz1_date', new Date().toISOString());
            localStorage.setItem('quiz1_passed', passed ? 'true' : 'false');
            localStorage.setItem('quiz1_correct', correctAnswers.toString());
            localStorage.setItem('quiz1_total', quiz.totalQuestions.toString());

            // Guardado del objeto completo (ARREGLADO)
            saveResultsLocally(score, correctAnswers);

            showResults(score, correctAnswers, passed);
        }

        function showResults(score, correctAnswers, passed) {
            document.getElementById('quizScreen').classList.remove('active');
            document.getElementById('resultsScreen').classList.add('active');
            
            const iconDiv = document.getElementById('resultIcon');
            if (passed) {
                iconDiv.innerHTML = '<span class="icon-trophy">üèÜ</span>';
            } else {
                iconDiv.innerHTML = '‚ùå';
            }
            
            document.getElementById('resultTitle').textContent = 
                passed ? '¬°Felicitaciones!' : 'Sigue intentando';
            
            const scoreNum = document.getElementById('scoreNumber');
            scoreNum.textContent = score + '%';
            scoreNum.className = 'score-number ' + (passed ? 'score-pass' : 'score-fail');
            
            document.getElementById('scoreLabel').textContent = 
                passed ? 'Has aprobado el quiz' : 'No has alcanzado la nota m√≠nima';
            
            document.getElementById('correctAnswers').textContent = 
                `Respuestas correctas: ${correctAnswers} de ${quiz.totalQuestions}`;
        }

        function returnToMain() {
            window.history.back();
        }

        // Funci√≥n para cargar y mostrar resultados de quizzes
        function loadQuizResults() {
            // Quiz 1
            const quiz1Score = localStorage.getItem('quiz1_score');
            const quiz1Passed = localStorage.getItem('quiz1_passed') === 'true';
            
            if (quiz1Score !== null) {
                displayQuizResult(1, quiz1Score, quiz1Passed);
            }
            
            // Puedes agregar m√°s quizzes aqu√≠ siguiendo el mismo patr√≥n
            // Quiz 2, 3, etc.
        }

        function displayQuizResult(quizNumber, score, passed) {
            const quizCard = document.querySelector(`[data-quiz-id="${quizNumber}"]`);
            if (!quizCard) return;
            
            // Buscar si ya existe un contenedor de resultado
            let resultDiv = quizCard.querySelector('.quiz-result');
            
            if (!resultDiv) {
                // Crear el contenedor de resultado
                resultDiv = document.createElement('div');
                resultDiv.className = 'quiz-result';
                quizCard.appendChild(resultDiv);
            }
            
            // Actualizar clase seg√∫n aprobado/reprobado
            resultDiv.className = 'quiz-result ' + (passed ? 'passed' : 'failed');
            
            // Actualizar contenido
            resultDiv.innerHTML = `
                <span class="result-icon">${passed ? '‚úì' : '‚úó'}</span>
                <div class="result-score">
                    <span class="percentage">${score}%</span>
                    <span class="label">${passed ? 'Aprobado' : 'Reprobado'}</span>
                </div>
            `;
        }
</script>
</body>
</html>